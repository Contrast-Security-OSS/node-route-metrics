# Integration tests

`test-integration/` contains tests that exercise route-metrics in a server.

## Components of the tests

### checks/
`checks/` is a framework for checking the entries in log files generated by route-metrics when running the server tests. while the primary use is for the integration tests, `header.js` is used by the make-header unit test.

#### structure
`index.js` is defines a class that is used to check log files for entries of interest. Checkers for each type of entry are added to it and when its `check` method is called, it checks an array of log objects against the checkers that have been added. E.g., if the header-checker has been added, it checks that a header object exists and that it is the first line in the file.

Each checker is a class that extends BaseChecker and has a `check` method that is called when the `type` of log file entry matches the checker's `type`.

Some checkers implement nothing more than the base class - they have a `requiredEntries` property (used when waiting for the log file to be written) and a `check` method that counts the number of entries of that type.

Other checkers, notably `route` and `patch`, perform checks for specific entries, allow or disallow duplicates, or use the test configuration to determine what needs to be checked. `header` is the only checker that makes a detailed check of the contents of the entry.

When written, each integration test file only spawns one server, so the log file accumulates across individual tests, so each test needs to add checkers that were added by a previous test.

### _helpers.js
`_helpers.js` It returns a generator function that yields instances of the Test class. To assure 100% coverage, each instance is a different combination of test parameters. The instance also implements a common setup method to simplify testing code.

### servers-*.test.js
`servers-*.test.js` are the integration tests for the servers. They verify that route-metrics works with all variations of servers and protocols (http, https now, http2 and spdy in the future) as well as different configurations of settings (all config settings are via env vars).




